from django . template import Library , TemplateSyntaxError from django . template . defaulttags import kwarg_re , SsiNode , URLNode register = Library ( ) @ register . tag def ssi ( parser , token ) : bits = token . split_contents ( ) parsed = False if len ( bits ) not in ( 2 , 3 ) : raise TemplateSyntaxError ( "'ssi' tag takes one argument: the path to" ) if len ( bits ) == 3 : if bits [ 2 ] == 'parsed' : parsed = True else : raise TemplateSyntaxError ( "Second (optional) argument to %s tag" % bits [ 0 ] ) filepath = parser . compile_filter ( bits [ 1 ] ) return SsiNode ( filepath , parsed , legacy_filepath = False ) @ register . tag def url ( parser , token ) : bits = token . split_contents ( ) if len ( bits ) < 2 : raise TemplateSyntaxError ( "'%s' takes at least one argument" % bits [ 0 ] ) viewname = parser . compile_filter ( bits [ 1 ] ) args = [ ] kwargs = { } asvar = None bits = bits [ 2 : ] if len ( bits ) >= 2 and bits [ - 2 ] == 'as' : asvar = bits [ - 1 ] bits = bits [ : - 2 ] if len ( bits ) : for bit in bits : match = kwarg_re . match ( bit ) if not match : raise TemplateSyntaxError ( "Malformed arguments to url tag" ) name , value = match . groups ( ) if name : kwargs [ name ] = parser . compile_filter ( value ) else : args . append ( parser . compile_filter ( value ) ) return URLNode ( viewname , args , kwargs , asvar , legacy_view_name = False )
