from django . db import transaction class TransactionMiddleware ( object ) : def process_request ( self , request ) : transaction . enter_transaction_management ( ) transaction . managed ( True ) def process_exception ( self , request , exception ) : if transaction . is_dirty ( ) : transaction . rollback ( ) transaction . leave_transaction_management ( ) def process_response ( self , request , response ) : if transaction . is_managed ( ) : if transaction . is_dirty ( ) : transaction . commit ( ) transaction . leave_transaction_management ( ) return response
