from django . conf import settings from django . core . handlers . wsgi import WSGIHandler from django . test import RequestFactory from django . utils import unittest class HandlerTests ( unittest . TestCase ) : def test_lock_safety ( self ) : old_middleware_classes = settings . MIDDLEWARE_CLASSES settings . MIDDLEWARE_CLASSES = 42 handler = WSGIHandler ( ) self . assertEqual ( handler . initLock . locked ( ) , False ) try : handler ( None , None ) except : pass self . assertEqual ( handler . initLock . locked ( ) , False ) settings . MIDDLEWARE_CLASSES = old_middleware_classes def test_bad_path_info ( self ) : environ = RequestFactory ( ) . get ( '/' ) . environ environ [ 'PATH_INFO' ] = '\xed' handler = WSGIHandler ( ) response = handler ( environ , lambda * a , ** k : None ) self . assertEqual ( response . status_code , 400 )
