import cx_Oracle from django . db . backends . oracle . introspection import DatabaseIntrospection class OracleIntrospection ( DatabaseIntrospection ) : data_types_reverse = DatabaseIntrospection . data_types_reverse . copy ( ) data_types_reverse [ cx_Oracle . OBJECT ] = 'GeometryField' def get_geometry_type ( self , table_name , geo_col ) : cursor = self . connection . cursor ( ) try : try : cursor . execute ( 'SELECT "DIMINFO", "SRID" FROM "USER_SDO_GEOM_METADATA" WHERE "TABLE_NAME"=%s AND "COLUMN_NAME"=%s' , ( table_name . upper ( ) , geo_col . upper ( ) ) ) row = cursor . fetchone ( ) except Exception , msg : raise Exception ( 'Could not find entry in USER_SDO_GEOM_METADATA corresponding to "%s"."%s"\n' % ( table_name , geo_col , msg ) ) field_type = 'GeometryField' field_params = { } dim , srid = row if srid != 4326 : field_params [ 'srid' ] = srid dim = len ( dim ) if dim != 2 : field_params [ 'dim' ] = dim finally : cursor . close ( ) return field_type , field_params
