from django . db import models from django . utils . translation import ugettext_lazy as _ class SessionManager ( models . Manager ) : def encode ( self , session_dict ) : return SessionStore ( ) . encode ( session_dict ) def save ( self , session_key , session_dict , expire_date ) : s = self . model ( session_key , self . encode ( session_dict ) , expire_date ) if session_dict : s . save ( ) else : s . delete ( ) return s class Session ( models . Model ) : session_key = models . CharField ( _ ( 'session key' ) , max_length = 40 , primary_key = True ) session_data = models . TextField ( _ ( 'session data' ) ) expire_date = models . DateTimeField ( _ ( 'expire date' ) , db_index = True ) objects = SessionManager ( ) class Meta : db_table = 'django_session' verbose_name = _ ( 'session' ) verbose_name_plural = _ ( 'sessions' ) def get_decoded ( self ) : return SessionStore ( ) . decode ( self . session_data ) from django . contrib . sessions . backends . db import SessionStore
