""" Extracts the version of the PostgreSQL server. """ import re VERSION_RE = re . compile ( r'\S+ (\d+)\.(\d+)\.?(\d+)?' ) def _parse_version ( text ) : major , major2 , minor = VERSION_RE . search ( text ) . groups ( ) try : return int ( major ) * 10000 + int ( major2 ) * 100 + int ( minor ) except ( ValueError , TypeError ) : return int ( major ) * 10000 + int ( major2 ) * 100 def get_version ( connection ) : if hasattr ( connection , 'server_version' ) : return connection . server_version else : cursor = connection . cursor ( ) cursor . execute ( "SELECT version()" ) return _parse_version ( cursor . fetchone ( ) [ 0 ] )
