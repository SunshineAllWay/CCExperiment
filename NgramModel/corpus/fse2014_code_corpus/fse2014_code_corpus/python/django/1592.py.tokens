from functools import wraps from django . utils . translation import ugettext as _ from django . contrib . admin . forms import AdminAuthenticationForm from django . contrib . auth . views import login from django . contrib . auth import REDIRECT_FIELD_NAME def staff_member_required ( view_func ) : @ wraps ( view_func ) def _checklogin ( request , * args , ** kwargs ) : if request . user . is_active and request . user . is_staff : return view_func ( request , * args , ** kwargs ) assert hasattr ( request , 'session' ) , "The Django admin requires session middleware to be installed. Edit your MIDDLEWARE_CLASSES setting to insert 'django.contrib.sessions.middleware.SessionMiddleware'." defaults = { : 'admin/login.html' , : AdminAuthenticationForm , : { : _ ( 'Log in' ) , : request . get_full_path ( ) , REDIRECT_FIELD_NAME : request . get_full_path ( ) , } , } return login ( request , ** defaults ) return _checklogin
