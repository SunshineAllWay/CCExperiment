from django . conf import settings from django . contrib . messages . storage import default_storage class MessageMiddleware ( object ) : def process_request ( self , request ) : request . _messages = default_storage ( request ) def process_response ( self , request , response ) : if hasattr ( request , '_messages' ) : unstored_messages = request . _messages . update ( response ) if unstored_messages and settings . DEBUG : raise ValueError ( 'Not all temporary messages could be stored.' ) return response
