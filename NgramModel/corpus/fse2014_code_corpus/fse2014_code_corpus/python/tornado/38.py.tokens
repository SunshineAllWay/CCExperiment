from __future__ import absolute_import , division , with_statement import datetime import unittest import time from tornado . testing import AsyncTestCase , LogTrapTestCase class TestIOLoop ( AsyncTestCase , LogTrapTestCase ) : def test_add_callback_wakeup ( self ) : def callback ( ) : self . called = True self . stop ( ) def schedule_callback ( ) : self . called = False self . io_loop . add_callback ( callback ) self . start_time = time . time ( ) self . io_loop . add_timeout ( time . time ( ) , schedule_callback ) self . wait ( ) self . assertAlmostEqual ( time . time ( ) , self . start_time , places = 2 ) self . assertTrue ( self . called ) def test_add_timeout_timedelta ( self ) : self . io_loop . add_timeout ( datetime . timedelta ( microseconds = 1 ) , self . stop ) self . wait ( ) if __name__ == "__main__" : unittest . main ( )
