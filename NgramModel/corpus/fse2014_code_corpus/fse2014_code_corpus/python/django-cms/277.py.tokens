from south . db import db from django . db import models from cms . models import * import datetime class Migration : def forwards ( self , orm ) : db . add_column ( 'cms_cmsplugin' , 'tree_id' , models . PositiveIntegerField ( db_index = True , editable = False , default = 0 ) ) db . add_column ( 'cms_cmsplugin' , 'lft' , models . PositiveIntegerField ( db_index = True , editable = False , default = 0 ) ) db . add_column ( 'cms_cmsplugin' , 'rght' , models . PositiveIntegerField ( db_index = True , editable = False , default = 0 ) ) db . add_column ( 'cms_cmsplugin' , 'level' , models . PositiveIntegerField ( db_index = True , editable = False , default = 0 ) ) if not db . dry_run : plugins = orm . CMSPlugin . objects . all ( ) . order_by ( 'page' , 'position' ) for plugin in plugins : if not plugin . parent_id and plugin . position : plugin . tree_id = plugin . position plugin . save ( ) for plugin in plugins : if plugin . parent_id : for p in plugins : if p . pk == plugin . parent_id and p . position : plugin . tree_id = p . tree_id plugin . save ( ) def backwards ( self , orm ) : db . delete_column ( 'cms_cmsplugin' , 'tree_id' ) db . delete_column ( 'cms_cmsplugin' , 'lft' ) db . delete_column ( 'cms_cmsplugin' , 'rght' ) db . delete_column ( 'cms_cmsplugin' , 'level' ) models = { : { : { 'ordering' : "('domain',)" , 'db_table' : "'django_site'" } , : True , : ( 'models.AutoField' , [ ] , { 'primary_key' : 'True' } ) } , : { : True , : ( 'models.AutoField' , [ ] , { 'primary_key' : 'True' } ) } , : { : ( 'models.BooleanField' , [ '_("can change soft-root")' ] , { 'default' : 'False' } ) , : ( 'models.BooleanField' , [ '_("can edit")' ] , { 'default' : 'True' } ) , : ( 'models.BooleanField' , [ '_("can publish")' ] , { 'default' : 'True' } ) , : ( 'models.BooleanField' , [ '_("everybody")' ] , { 'default' : 'False' } ) , : ( 'models.ForeignKey' , [ 'Group' ] , { 'null' : 'True' , 'verbose_name' : '_("group")' , 'blank' : 'True' } ) , : ( 'models.AutoField' , [ ] , { 'primary_key' : 'True' } ) , : ( 'models.ForeignKey' , [ 'Page' ] , { 'null' : 'True' , 'verbose_name' : '_("page")' , 'blank' : 'True' } ) , : ( 'models.IntegerField' , [ '_("type")' ] , { 'default' : '0' } ) , : ( 'models.ForeignKey' , [ 'User' ] , { 'null' : 'True' , 'verbose_name' : '_("user")' , 'blank' : 'True' } ) } , : { : ( 'models.DateTimeField' , [ '_("creation date")' ] , { 'default' : 'datetime.datetime.now' , 'editable' : 'False' } ) , : ( 'models.AutoField' , [ ] , { 'primary_key' : 'True' } ) , : ( 'models.CharField' , [ '_("language")' ] , { 'db_index' : 'True' , 'max_length' : '3' , 'editable' : 'False' , 'blank' : 'False' } ) , : ( 'models.PositiveIntegerField' , [ ] , { 'db_index' : True , 'editable' : False } ) , : ( 'models.PositiveIntegerField' , [ ] , { 'db_index' : True , 'editable' : False } ) , : ( 'models.ForeignKey' , [ 'Page' ] , { 'editable' : 'False' , 'verbose_name' : '_("page")' } ) , : ( 'models.ForeignKey' , [ "'self'" ] , { 'null' : 'True' , 'editable' : 'False' , 'blank' : 'True' } ) , : ( 'models.CharField' , [ '_("slot")' ] , { 'max_length' : '50' , 'editable' : 'False' , 'db_index' : 'True' } ) , : ( 'models.CharField' , [ '_("plugin_name")' ] , { 'max_length' : '50' , 'editable' : 'False' , 'db_index' : 'True' } ) , : ( 'models.PositiveSmallIntegerField' , [ '_("position")' ] , { 'null' : 'True' , 'editable' : 'False' , 'blank' : 'True' } ) , : ( 'models.PositiveIntegerField' , [ ] , { 'db_index' : True , 'editable' : False } ) , : ( 'models.PositiveIntegerField' , [ ] , { 'db_index' : True , 'editable' : False } ) , } , : { : { 'unique_together' : "(('language','page'),)" } , : ( 'models.DateTimeField' , [ '_("creation date")' ] , { 'default' : 'datetime.datetime.now' , 'editable' : 'False' } ) , : ( 'models.AutoField' , [ ] , { 'primary_key' : 'True' } ) , : ( 'models.CharField' , [ '_("language")' ] , { 'max_length' : '3' , 'db_index' : 'True' } ) , : ( 'models.ForeignKey' , [ 'Page' ] , { 'related_name' : '"title_set"' , 'verbose_name' : '_("page")' } ) , : ( 'models.CharField' , [ '_("path")' ] , { 'max_length' : '255' , 'db_index' : 'True' } ) , : ( 'models.SlugField' , [ '_("slug")' ] , { 'unique' : 'False' , 'max_length' : '255' , 'db_index' : 'True' } ) , : ( 'models.CharField' , [ '_("title")' ] , { 'max_length' : '255' } ) } , : { : { 'ordering' : "('tree_id','lft')" } , : ( 'models.ForeignKey' , [ 'User' ] , { 'limit_choices_to' : "{'page__isnull':False}" , 'verbose_name' : '_("author")' } ) , : ( 'models.DateTimeField' , [ ] , { 'default' : 'datetime.datetime.now' , 'editable' : 'False' } ) , : ( 'models.BooleanField' , [ '_("has url overwrite")' ] , { 'default' : 'False' , 'db_index' : 'True' } ) , : ( 'models.AutoField' , [ ] , { 'primary_key' : 'True' } ) , : ( 'models.BooleanField' , [ '_("in navigation")' ] , { 'default' : 'True' , 'db_index' : 'True' } ) , : ( 'models.PositiveIntegerField' , [ ] , { 'db_index' : True , 'editable' : False } ) , : ( 'models.PositiveIntegerField' , [ ] , { 'db_index' : True , 'editable' : False } ) , : ( 'models.BooleanField' , [ "_('login required')" ] , { 'default' : 'False' } ) , : ( 'models.CharField' , [ '_("navigation extenders")' ] , { 'blank' : 'True' , 'max_length' : '80' , 'null' : 'True' , 'db_index' : 'True' } ) , : ( 'models.ForeignKey' , [ "'self'" ] , { 'db_index' : 'True' , 'related_name' : "'children'" , 'null' : 'True' , 'editable' : 'False' , 'blank' : 'True' } ) , : ( 'models.DateTimeField' , [ '_("publication date")' ] , { 'null' : 'True' , 'db_index' : 'True' , 'blank' : 'True' } ) , : ( 'models.DateTimeField' , [ '_("publication end date")' ] , { 'null' : 'True' , 'db_index' : 'True' , 'blank' : 'True' } ) , : ( 'models.CharField' , [ '_("id")' ] , { 'blank' : 'True' , 'max_length' : '40' , 'null' : 'True' , 'db_index' : 'True' } ) , : ( 'models.PositiveIntegerField' , [ ] , { 'db_index' : True , 'editable' : False } ) , : ( 'models.ManyToManyField' , [ 'Site' ] , { 'default' : '[settings.SITE_ID]' , 'verbose_name' : '_("sites")' } ) , : ( 'models.BooleanField' , [ '_("soft root")' ] , { 'default' : 'False' , 'db_index' : 'True' } ) , : ( 'models.IntegerField' , [ '_("status")' ] , { 'default' : 0 , 'db_index' : 'True' } ) , : ( 'models.CharField' , [ '_("template")' ] , { 'max_length' : '100' } ) , : ( 'models.PositiveIntegerField' , [ ] , { 'db_index' : True , 'editable' : False } ) , : ( 'models.CharField' , [ '_("url overwrite")' ] , { 'blank' : 'True' , 'max_length' : '80' , 'null' : 'True' , 'db_index' : 'True' } ) } , : { : True , : ( 'models.AutoField' , [ ] , { 'primary_key' : 'True' } ) } } complete_apps = [ 'cms' ]
