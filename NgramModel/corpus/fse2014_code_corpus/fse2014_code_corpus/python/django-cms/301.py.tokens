from django . db import models import reversion from reversion . revisions import RegistrationError , RegistrationInfo def register_draft_only ( model_class , fields , follow , format ) : revision_manager = reversion . revision if revision_manager . is_registered ( model_class ) : raise RegistrationError ( % model_class ) if ( model_class . _meta . proxy and not revision_manager . is_registered ( model_class . _meta . parents . keys ( ) [ 0 ] ) ) : raise RegistrationError ( % model_class ) opts = model_class . _meta local_fields = opts . local_fields + opts . local_many_to_many if fields is None : fields = [ field . name for field in local_fields ] fields = tuple ( fields ) follow = tuple ( follow ) registration_info = RegistrationInfo ( fields , follow , format ) revision_manager . _registry [ model_class ] = registration_info
