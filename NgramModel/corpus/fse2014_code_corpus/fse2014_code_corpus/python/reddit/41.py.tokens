import os from pylons import config import mimetypes mimetypes . init ( ) import webhelpers from r2 . config . routing import make_map import r2 . lib . app_globals as app_globals from r2 . lib import rpc import r2 . lib . helpers import r2 . config as reddit_config from r2 . templates import tmpl_dirs def load_environment ( global_conf = { } , app_conf = { } , setup_globals = True ) : map = make_map ( global_conf , app_conf ) root_path = os . path . dirname ( os . path . dirname ( os . path . abspath ( __file__ ) ) ) paths = { 'root' : root_path , : os . path . join ( root_path , 'controllers' ) , : tmpl_dirs , : os . path . join ( root_path , 'public' ) } config . init_app ( global_conf , app_conf , package = 'r2' , template_engine = 'mako' , paths = paths ) g = config [ 'pylons.g' ] = app_globals . Globals ( global_conf , app_conf , paths ) if setup_globals : g . setup ( global_conf ) reddit_config . cache = g . cache config [ 'pylons.h' ] = r2 . lib . helpers config [ 'routes.map' ] = map config [ 'pylons.response_options' ] [ 'headers' ] = { } tmpl_options = config [ 'buffet.template_options' ] tmpl_options [ 'mako.filesystem_checks' ] = getattr ( g , 'reload_templates' , False ) tmpl_options [ 'mako.default_filters' ] = [ "mako_websafe" ] tmpl_options [ 'mako.imports' ] = [ "from r2.lib.filters import websafe, unsafe, mako_websafe" , , ]
