from cache import * c1 = LocalCache ( ) c2 = Memcache ( ( '127.0.0.1:11211' , ) ) c = CacheChain ( ( c1 , c2 ) ) c . set ( '1' , 1 ) assert ( c1 . get ( '1' ) == 1 ) assert ( c2 . get ( '1' ) == 1 ) assert ( c . get ( '1' ) == 1 ) c . set ( '2' , [ 1 , 2 , 3 ] ) assert ( c1 . get ( '2' ) == [ 1 , 2 , 3 ] ) assert ( c2 . get ( '2' ) == [ 1 , 2 , 3 ] ) assert ( c . get ( '2' ) == [ 1 , 2 , 3 ] ) c . set_multi ( { '3' : 3 , '4' : 4 } ) assert ( c1 . get_multi ( ( '3' , '4' ) ) == { '3' : 3 , '4' : 4 } ) assert ( c2 . get_multi ( ( '3' , '4' ) ) == { '3' : 3 , '4' : 4 } ) assert ( c . get_multi ( ( '3' , '4' ) ) == { '3' : 3 , '4' : 4 } ) c . set_multi ( { '3' : 3 , '4' : 4 } , prefix = 'p_' ) assert ( c1 . get_multi ( ( '3' , 4 ) , prefix = 'p_' ) == { '3' : 3 , 4 : 4 } ) assert ( c2 . get_multi ( ( '3' , 4 ) , prefix = 'p_' ) == { '3' : 3 , 4 : 4 } ) assert ( c . get_multi ( ( '3' , 4 ) , prefix = 'p_' ) == { '3' : 3 , 4 : 4 } ) assert ( c1 . get_multi ( ( 'p_3' , 'p_4' ) ) == { 'p_3' : 3 , 'p_4' : 4 } ) assert ( c2 . get_multi ( ( 'p_3' , 'p_4' ) ) == { 'p_3' : 3 , 'p_4' : 4 } ) assert ( c . get_multi ( ( 'p_3' , 'p_4' ) ) == { 'p_3' : 3 , 'p_4' : 4 } ) c . set ( '5' , 1 ) c . set ( '6' , 1 ) c . incr ( '5' ) assert ( c1 . get ( '5' ) , 2 ) assert ( c2 . get ( '5' ) , 2 ) assert ( c . get ( '5' ) , 2 ) c . incr ( '5' , 2 ) assert ( c1 . get ( '5' ) , 4 ) assert ( c2 . get ( '5' ) , 4 ) assert ( c . get ( '5' ) , 4 ) c . incr_multi ( ( '5' , '6' ) , 1 ) assert ( c1 . get ( '5' ) , 5 ) assert ( c2 . get ( '5' ) , 5 ) assert ( c . get ( '5' ) , 5 ) assert ( c1 . get ( '6' ) , 2 ) assert ( c2 . get ( '6' ) , 2 ) assert ( c . get ( '6' ) , 2 ) c . flush_all ( ) c . set ( '1' , 1 ) c2 . set ( '2' , 2 ) c2 . set ( '1' , 4 ) c . set ( '3' , 3 ) assert ( c . get_multi ( ( 1 , 2 , 3 ) ) == { 1 : 1 , 2 : 2 , 3 : 3 } )
